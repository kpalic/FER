"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[219],{9211:function(e,n,t){t.d(n,{Qb:function(){return I},p9:function(){return b}});var r=t(94776),i=t.n(r),o=t(5632),a=t.n(o),u=t(52251),c=t(66700),s=t(19785);function l(e){(0,s.Z)(1,arguments);var n=(0,c.Z)(e),t=n.getTime();return t}function f(e){return(0,s.Z)(1,arguments),Math.floor(l(e)/1e3)}var d=t(7878);function p(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var v={defaultTTL:86400},h=function(){function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v;p(this,e),this._storage=n,this._options=t}var n=e.prototype;return n.setItem=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._options.defaultTTL,r=f(new Date),i={value:n,exp:r+t};this._storage.setItem(e,i)},n.getItem=function(e){var n=this._storage.getItem(e);if(null==n||"object"!==typeof n)return n;if(!Reflect.has(n,"value")||!Reflect.has(n,"exp"))return console.warn('ExpiryLocalStorage.getItem("'.concat(e,'") - data is malformed'),n),null;var t=f(new Date);return t>n.exp?(console.debug('ExpiryLocalStorage.getItem("'.concat(e,'") - data has expired ').concat(t-n.exp," seconds ago")),this._storage.removeItem(e),null):n.value},n.removeItem=function(e){this._storage.removeItem(e)},n.clear=function(){this._storage.clear()},e}(),m=new h(d.J);function g(e,n,t,r,i,o,a){try{var u=e[o](a),c=u.value}catch(s){return void t(s)}u.done?n(c):Promise.resolve(c).then(r,i)}function y(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){g(o,r,i,a,u,"next",e)}function u(e){g(o,r,i,a,u,"throw",e)}a(void 0)}))}}var w="auth/redirect";function b(e){m.setItem(w,e,900)}function _(){return m.getItem(w)}function A(){m.removeItem(w)}function I(e,n){return x.apply(this,arguments)}function x(){return(x=y(i().mark((function e(n,t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=_(),console.debug("Redirect to ".concat(null!==r&&void 0!==r?r:n)),!r){e.next=9;break}return A(),u.Z.trackEvent("login-page","redirect_to_saved_path",{source:t,url:r,workspaceId:r.split("/")[2]}),e.next=7,a().replace(r);case 7:e.next=11;break;case 9:return e.next=11,a().replace(n);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},60219:function(e,n,t){t.d(n,{i:function(){return D}});var r=t(2784),i=t(5632),o=t.n(i),a=t(20810),u=t(39739),c=t(69904),s=t(68594);var l=t(82808),f=t(35120),d=t(12335),p=t(11348),v=t(77984),h=t(9211),m=t(33337),g=t(19605),y=t(41575),w=t(94776),b=t.n(w),_=t(94608),A=t(3213);function I(e,n,t,r,i,o,a){try{var u=e[o](a),c=u.value}catch(s){return void t(s)}u.done?n(c):Promise.resolve(c).then(r,i)}var x=function(){var e,n=(e=b().mark((function e(n){var t;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.Z.teams.withConverter(_.ML).where("isAutoJoinEnabled","==",!0).where("domain","==",n).get();case 2:return t=e.sent,e.abrupt("return",t.docs.map((function(e){return e.data()})));case 4:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){I(o,r,i,a,u,"next",e)}function u(e){I(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),T=x;function R(e,n,t,r,i,o,a){try{var u=e[o](a),c=u.value}catch(s){return void t(s)}u.done?n(c):Promise.resolve(c).then(r,i)}var N=function(){var e,n=(e=b().mark((function e(n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.Z.userTeams(n).limit(1).get();case 2:return e.abrupt("return",!e.sent.empty);case 3:case"end":return e.stop()}}),e)})),function(){var n=this,t=arguments;return new Promise((function(r,i){var o=e.apply(n,t);function a(e){R(o,r,i,a,u,"next",e)}function u(e){R(o,r,i,a,u,"throw",e)}a(void 0)}))});return function(e){return n.apply(this,arguments)}}(),k=N,E=["website","notion","integration","diagramgpt","chatgpt","sourcegraph-cody"];function P(e){return"string"!==typeof e?"other":E.includes(e)?e:"other"}var C=t(57066),U=t(66924),S=t(47985),O=t(90396);function Z(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function L(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,o=[],a=!0,u=!1;try{for(t=t.call(e);!(a=(r=t.next()).done)&&(o.push(r.value),!n||o.length!==n);a=!0);}catch(c){u=!0,i=c}finally{try{a||null==t.return||t.return()}finally{if(u)throw i}}return o}}(e,n)||function(e,n){if(!e)return;if("string"===typeof e)return Z(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(t);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Z(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var q=function(e){o().replace(e)},j=function(){return q("/team/create")};function D(){var e=(0,r.useState)(),n=e[0],t=e[1],i=(0,r.useState)({}),w=i[0],b=i[1],_=(0,g.K)(),A=(0,r.useRef)({redirect:"",isRedirecting:!1});(0,c.Z)((function(){var e=o().query.redirect;"string"===typeof e&&((0,h.p9)(e),A.current.redirect=e)})),(0,r.useEffect)((function(){var e=function(e){var n=e.ref,t=e.utm_campaign,r=e.templateId;return t?{signUpOrigin:"paid",signUpCampaign:t}:r?{signUpOrigin:"website",signUpTemplate:r}:{signUpOrigin:P(n)}}(_);b(e)}),[_]);var I=(0,r.useCallback)((function(){o().prefetch("/dashboard/all"),o().prefetch("/dashboard/recents"),o().prefetch("/team/create"),o().prefetch("/team/join")}),[]),x=(0,r.useCallback)((function(){o().query.redirect_uri===y.NOTION_INTEGRATION_REDIRECT_URL&&o().replace("/notion/auth?"+new URLSearchParams(o().query).toString())}),[]),R=(0,r.useCallback)((function(e){console.info("[Auth Page] Something went wrong",e),(0,U.Tb)(e),t(e)}),[]),N=(0,a.m)((function(){return function(e){return new s.y((function(n){return{unsubscribe:e.onAuthStateChanged(n)}}))}(C.I8).pipe((0,d.w)((function(e){return(0,l.s)((function(){return e&&!e.isAnonymous&&e.providerData.length>0}),(0,f.of)(e).pipe((0,p.b)((function(e){return console.info("[Auth Page] User signed in:",{uid:e.uid,email:e.email,isAnonymous:e.isAnonymous,displayName:e.displayName})})),(0,p.b)(x),(0,p.b)(I),(0,p.b)((function(){var e=A.current.redirect;if(null===e||void 0===e?void 0:e.match("/new")){var n,t=(null===(n=o().asPath)||void 0===n?void 0:n.match("sign-up"))?"sign-up":"sign-in";(0,h.Qb)("/dashboard/all",t),A.current.isRedirecting=!0}})),(0,d.w)((function(e){return k(e.uid)})),(0,O.VK)(),(0,d.w)((function(n){return!n&&e.email&&e.emailVerified&&!A.current.isRedirecting?(0,f.of)((0,S.ZP)(e.email)).pipe((0,d.w)((function(e){return T(e)})),(0,O.VK)(),(0,v.U)((function(e){return[n,e]}))):(0,f.of)([n,[]])})),(0,p.b)((function(n){var t=L(n,2),r=t[0],i=t[1];if(!A.current.isRedirecting)if(r){var a;console.info("[Auth Page] User has team, redirect to ...");var u=(null===(a=o().asPath)||void 0===a?void 0:a.match("sign-up"))?"sign-up":"sign-in";(0,h.Qb)("/dashboard/all",u)}else e.email?(console.info("[Auth Page] User has ".concat(i.length," teams with the same domain")),i.length>0?q("/team/join"):j()):(console.info("[Auth Page] User doesn't have email, redirect to team create"),j())}))),(0,f.of)(e).pipe((0,p.b)((function(e){return console.info("[Auth Page] User signed out:",{uid:null===e||void 0===e?void 0:e.uid,email:null===e||void 0===e?void 0:e.email,isAnonymous:null===e||void 0===e?void 0:e.isAnonymous,displayName:null===e||void 0===e?void 0:e.displayName})})),(0,p.b)((function(){return(0,m.hf)()}))))})))}));return(0,u.m)(N,void 0,R),{error:n,profileArgs:w}}},41575:function(e,n,t){t.r(n),t.d(n,{NOTION_INTEGRATION_REDIRECT_URL:function(){return d},default:function(){return p}});var r=t(52322),i=t(2784),o=t(94764),a=t(5632),u=t(60759),c=t(14898),s=t(48215),l=function(e){return(0,s.Z)("notion-retrieveToken",e)},f=t(66924),d="https://www.notion.so/externalintegrationauthcallback",p=function(){var e=(0,a.useRouter)(),n=(0,c.fC)(),t=e.query.code,s=e.query.redirect_uri,d=e.query.state;return(0,i.useEffect)((function(){if(n&&t)if(null===n||void 0===n?void 0:n.isAnonymous)e.replace("/auth/sign-up?ref=notion&"+new URLSearchParams(e.query).toString());else{var r=(0,o.x0)();l({notionAuthCode:t,tempAuthCode:r,userEmail:n.email,userDisplayName:n.displayName}).then((function(e){null!=e?location.replace(s+"?code=".concat(r,"&state=").concat(d)):location.replace(s+"?error=access_denied&error_description=Not+valid+access+token..")})).catch((function(e){(0,f.Tb)(e),location.replace(s+"?error=access_denied&error_description=An+internal+server+error+occurred.")}))}}),[n,t,d,s,e]),s&&t&&d?null:(0,r.jsx)(u.Z,{statusCode:400,title:"Not enough query parameters specified"})}}}]);