(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7971],{24962:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/new",function(){return n(48105)}])},48105:function(t,e,n){"use strict";n.r(e);var r=n(94776),a=n.n(r),o=n(52322),u=n(2784),c=n(5632),i=n.n(c),s=n(60759),f=n(96914),l=n(68732),p=n(19605),d=n(14898),h=n(35621),v=n(36710),w=n(64103),y=n(17366),m=n(93747),b=n(66924),g=n(48834).Buffer;function x(t,e,n,r,a,o,u){try{var c=t[o](u),i=c.value}catch(s){return void n(s)}c.done?e(i):Promise.resolve(i).then(r,a)}e.default=function(){var t=(0,d.II)(),e=(0,l.LP)(),n=(0,d.g5)(),r=(0,l.MV)(),c=(0,u.useState)(),O=c[0],k=c[1],_=(0,u.useState)(!1),I=_[0],j=_[1],P=(0,p.K)(),D=P.templateId,S=P.elementData,E=P.autoDiagramId,R=P.ref,T=P.state;return(0,y.Z)((function(){if(t&&(n||r)&&!I)if(j(!0),n){var o=null!==R&&void 0!==R?R:E?"diagramgpt":void 0;i().push({pathname:"/auth/sign-up",query:{redirect:i().asPath,ref:o}},"/auth/sign-up")}else{var u;(u=a().mark((function n(){var r,o,u,c,s,l,p,d,y;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(j(!0),n.prev=2,!D){n.next=9;break}return n.next=6,(0,v.Z)({teamId:e,workspaceId:D,workspaceOverrides:{folderId:null}});case 6:r=n.sent.workspaceId,n.next=43;break;case 9:if(!S){n.next=22;break}return o=JSON.parse(g.from(S,"base64").toString("utf-8")),n.next=13,(0,f.En)(o).catch((function(t){throw new w.tk("Could not create elements from URL",{cause:t,data:{elementData:S}})}));case 13:return u=n.sent,n.next=17,(0,h.M)({ownerId:t,teamId:e,elementData:u},"eraser_new","new");case 17:c=n.sent,r=c.id,n.next=43;break;case 22:if(!E){n.next=37;break}return n.next=25,(0,m.jY)(E,T);case 25:return s=n.sent,n.next=28,(0,f.En)(s).catch((function(t){throw new w.tk("Could not create diagram",{cause:t,data:{autoDiagramId:E}})}));case 28:return l=n.sent,n.next=32,(0,h.M)({ownerId:t,teamId:e,elementData:l},"eraser_new","new");case 32:p=n.sent,r=p.id,n.next=43;break;case 37:return n.next=40,(0,h.M)({ownerId:t,teamId:e},"eraser_new","new");case 40:d=n.sent,r=d.id;case 43:return y=E?"?layout=canvas":"",n.next=46,i().replace("/workspace/".concat(r).concat(y));case 46:n.next=52;break;case 48:n.prev=48,n.t0=n.catch(2),(0,b.Tb)(n.t0),k(n.t0);case 52:case"end":return n.stop()}}),n,null,[[2,48]])})),function(){var t=this,e=arguments;return new Promise((function(n,r){var a=u.apply(t,e);function o(t){x(a,n,r,o,c,"next",t)}function c(t){x(a,n,r,o,c,"throw",t)}o(void 0)}))})()}}),[I,t,e,n,r,D,S,E,T,R]),O?(0,o.jsx)(s.Z,{statusCode:500,title:"Something went wrong",error:O}):(0,o.jsx)(f.mX,{})}},93747:function(t,e,n){"use strict";n.d(e,{VH:function(){return x},jY:function(){return I}});var r=n(94776),a=n.n(r),o=n(30686),u=n(94764),c=n(95879),i=n(57066),s=n(64103);function f(t,e,n,r,a,o,u){try{var c=t[o](u),i=c.value}catch(s){return void n(s)}c.done?e(i):Promise.resolve(i).then(r,a)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function u(t){f(o,r,a,u,c,"next",t)}function c(t){f(o,r,a,u,c,"throw",t)}u(void 0)}))}}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){p(t,e,n[e])}))}return t}function v(t,e){if(null==t)return{};var n,r,a=function(t,e){if(null==t)return{};var n,r,a={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(a[n]=t[n]);return a}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function w(t,e){return!e||"object"!==m(e)&&"function"!==typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function y(t,e){return(y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var m=function(t){return t&&"undefined"!==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};function b(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=d(t);if(e){var a=d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return w(this,n)}}var g=function(t){!function(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&y(t,e)}(n,t);var e=b(n);function n(t,r){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(a=e.call(this)).requestId=t,a.stateId=r,a._isDestroyed=!1,a.ref=i.RZ.collection("auto-diagram-requests").doc(t),a._unsub=a.ref.onSnapshot((function(t){var e=t.data();e?a.emit("update",h({id:t.id},e)):a.emit("delete",t.id)})),a}return n.prototype.destroy=function(){this._isDestroyed||(this._unsub(),this._isDestroyed=!0)},n}(o.v);function x(t){return O.apply(this,arguments)}function O(){return(O=l(a().mark((function t(e){var n,r,o,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,u.x0)(),r=e.user,o=v(e,["user"]),t.next=4,i.RZ.collection("auto-diagram-requests").add({args:o,userId:r,stateId:n});case 4:return c=t.sent,t.abrupt("return",new g(c.id,n));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t,e){return _.apply(this,arguments)}function _(){return(_=l(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.Z.post("ai/".concat(e,"/").concat(n),{});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function I(t,e){return j.apply(this,arguments)}function j(){return(j=l(a().mark((function t(e,n){var r,o,u,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(t){var e;return(null!==(e=t.diagrams)&&void 0!==e?e:[]).filter((function(t){return t.diagramType&&t.code})).map((function(t){return h({},t,{diagramType:t.diagramType,type:"diagram"})}))},t.prev=1,t.next=4,i.RZ.collection("auto-diagram-requests").doc(e).get();case 4:if((o=t.sent).exists){t.next=7;break}throw new s.tk("Diagram data not found",{data:{autoDiagramId:e,statusCode:404}});case 7:return u=o.data(),t.abrupt("return",r(u));case 11:if(t.prev=11,t.t0=t.catch(1),!0,!n){t.next=27;break}return t.prev=15,t.next=18,k(e,n);case 18:return c=t.sent,t.abrupt("return",r(c));case 22:throw t.prev=22,t.t1=t.catch(15),new s.tk("Failed to load diagram data",{cause:t.t1,data:{autoDiagramId:e}});case 25:t.next=28;break;case 27:throw new s.tk("Failed to load diagram data",{cause:t.t0,data:{autoDiagramId:e}});case 28:case"end":return t.stop()}}),t,null,[[1,11],[15,22]])})))).apply(this,arguments)}}},function(t){var e=function(e){return t(t.s=e)};t.O(0,[6914,9774,2888,179],(function(){return e(412),e(24962)}));var n=t.O();_N_E=n}]);